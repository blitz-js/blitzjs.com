---
title: Migrating to Blitz
sidebar_label: Migrating to Blitz
---

## Migrating from Next.js {#migrating-from-next}

Blitz is built on top of Next.js, so naturally follows Next's priciples
and patterns. The difference between Next and Blitz is that Blitz adds all
the missing features and functionality that turns Next into a true
fullstack framework. That also means that you can migrate to Blitz in a
few steps.

### 1. Replace dependencies {#replace-deps}

You need to replace `next` dependency with `blitz`.

```sh
yarn remove next ## npm uninstall next
yarn add blitz ## npm install blitz
```

### 2. Update scripts in `package.json` {#update-scripts}

Instead of using `next` to run command, you can use `blitz`. There are a
few other command that you can find useful — read about it
[here](/docs/cli-overview).

```diff
"scripts": {
  "dev": "blitz dev",
  "build": "blitz build",
  "start": "blitz start"
}
```

### 3. Rename configuration file {#rename-config-file}

As the third step, you need to rename `next.config.*` to `blitz.config.*`.
Here you can read more about configuration. To learn more about
configuration, check out the [docs](/docs/blitz-config).

### What's next? {#what-is-next}

If you want to start using Blitz's [queries](/docs/query-resolvers) and
[mutations](/docs/mutation-resolvers), we recommend creating an `app`
folder and writing your application logic there. You can take a look at
[the default file structure of newly generated Blitz apps](/docs/file-structure).
In the following sections, we'll cover how to setup a database, and
Blitz's auth.

#### Add a database {#add-database}

By default, Blitz uses Prisma which is a strongly typed database client.
If you are new to databases, check out
[Prisma's Data Guide](https://www.prisma.io/dataguide/) which covers the
very large majority of everything you might want to know.

As the first step, you need to add required dependecies:

```sh
yarn add prisma @prisma/client ## npm install prisma @prisma/client
```

Once this is done, you can initialize Prisma:

```sh
blitz prisma init
```

You can optionally pass `--datasource-provider=sqlite`. The default driver
is Postgres.

The `init` command will create a new folder, `prisma`, with a
`schema.prisma` file where you can define your database models.

For Blitz to work properly, you'll need to rename the `prisma` folder to
`db`, and add the following to your `package.json` file:

```json
"prisma": {
  "schema": "db/schema.prisma"
},
```

Then, you have to create a `client.ts` (or `client.js`) file in the `db`
folder. Inside we'll use `enhancePrisma` function from Blitz to wrap the
Prisma's client:

```ts
// db/client.ts

import { enhancePrisma } from "blitz"
import { PrismaClient } from "@prisma/client"

const EnhancedPrisma = enhancePrisma(PrismaClient)

export * from "@prisma/client"
export default new EnhancedPrisma()
```

Check out our [Database Overview docs](/docs/database-overview) to learn
more about the database setup, Prisma, and some useful utilities.

#### Setup Blitz auth {#setup-blitz-auth}

In order to use Blitz's built-in auth, you need to create required
database models. Add the following code to your `db/schema.prisma` file:

```
model User {
  id             Int      @id @default(autoincrement())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  name           String?
  email          String   @unique
  hashedPassword String?
  role           String   @default("USER")

  tokens   Token[]
  sessions Session[]
}

model Session {
  id                 Int       @id @default(autoincrement())
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  expiresAt          DateTime?
  handle             String    @unique
  hashedSessionToken String?
  antiCSRFToken      String?
  publicData         String?
  privateData        String?

  user   User? @relation(fields: [userId], references: [id])
  userId Int?
}

model Token {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  hashedToken String
  type        String
  expiresAt   DateTime
  sentTo      String

  user   User @relation(fields: [userId], references: [id])
  userId Int

  @@unique([hashedToken, type])
}
```

Then run `blitz prisma migrate dev` in your terminal to apply the changes
to your database and update Prisma client.

You also need to update your `blitz.config.*` file and add
`sessionMiddleware` setup:

```ts
// blitz.config.js
import { BlitzConfig, sessionMiddleware } from "blitz"

const config: BlitzConfig = {
  middleware: [
    sessionMiddleware({
      cookiePrefix: "your-app-name",
    }),
  ],
}
module.exports = config
```

You can take a look at
[our examples](https://github.com/blitz-js/blitz/tree/canary/examples/auth/app/auth/mutations)
to see how to implement login, logout, sign up, and more, with Blitz's
mutations and sessions.

Follow [this documentation](/docs/authorization#is-authorized-adapters) to
setup authorization.

### Further reading {#further-reading}

- If you're new to Blitz, we recommend checking out our
  [tutorial](/docs/tutorial) to learn about some of the core Blitz's
  concepts.
- [Database Overview](/docs/database-overview)
- [Auth Overview](/docs/auth)
- Learn more about [queries](/docs/query-resolvers) and
  [mutations](/docs/mutation-resolvers)

## Incrementally Adopting Blitz.js {#migrating-incrementally}

You can adopt Blitz incrementally by starting small and adding more pages
with time. This way you can prevent derailing feature work by avoiding a
complete rewrite.

### Using subpath {#subpath}

The first strategy is to configure your server or proxy such that,
everything under a specific subpath points to a Blitz.js app. For example,
your existing website might be at `example.com`, and you might configure
your proxy such that `example.com/store` serves a Blitz.js e-commerce
store.

Using [`basePath`](/blitz-config#base-path), you can configure your
Blitz.js application's assets and links to automatically work with your
new subpath `/store`. Since each page in Blitz.js is its own
[standalone route](/routing), pages like `pages/products/index.tsx` will
route to `example.com/store/products` in your application.

```jsx
// blitz.config.ts

module.exports = {
  basePath: "/store",
}
```

To learn more about `basePath`, take a look at our
[documentation](/blitz-config#base-path).

### Using rewrites {#rewrites}

The second strategy is to create a new Blitz.js app that points to the
root URL of your domain. Then, you can use [`rewrites`](/rewrites) inside
`blitz.config.ts` to have some subpaths to be proxied to your existing
app.

For example, let's say you created a Blitz.js app to be served from
`example.com` with the following `blitz.config.ts`. Now, requests for the
pages you’ve added to this Blitz.js app (e.g. `/about` if you’ve added
`pages/about.tsx`) will be handled by Next.js, and requests for any other
route (e.g. `/dashboard`) will be proxied to `proxy.example.com`.

```jsx
// blitz.config.js

module.exports = {
  async rewrites() {
    return {
      // After checking all Blitz.js pages (including dynamic routes)
      // and static files we proxy any other requests
      fallback: [
        {
          source: "/:path*",
          destination: `https://proxy.example.com/:path*`,
        },
      ],
    }
  },
}
```

To learn more about rewrites, take a look at our
[documentation](/docs/rewrites).

<!-- ### FAQ -->
